# -基于PyQt的监控数据集人脸手动遮挡程序-
## 1 项目简介
对于监控视频的数据集当中，会拍摄到行人的脸部，为了保护其隐私，需要对数据集的人脸部分进行手动遮盖，并且保存这给位置呈灰色的黑底图像。本项目基于PyQt5，完成了上述基本任务。
## 2 基本功能
本项目主要功能为手动遮挡图像数据集中人脸部分。首先使用者可以加载一幅RGB图像到程序窗口，同时会生成一幅与其同宽高的全黑像素图。然后使用者可以再加载一幅IR图像（绝大多数情况下，除色域之外，其他与RGB图像完全相同）到程序窗口，并对这三幅图像同时进行操作。在RGB图像上面使用鼠标画笔对人脸部分进行遮盖的同时，笔迹会在IR图像和全黑像素图的相同位置出现。完成人脸遮盖之后，可以保存改动后的全黑像素图像。还能够实时显示当前操作的RGB图像和IR图像的绝对位置，和要保存的改动后的全黑像素图的保存路径。另外，为了对使用者友好，本程序还设置了，上一张，下一张，清空笔迹等快捷键。
![face_cover](https://user-images.githubusercontent.com/45918664/184271301-c58bd8d8-1855-49a5-ae58-8b71927b272f.png)
## 3 运行环境
本人运行本程序的计算机操作系统为Windows 11，Python解释器版本为Python 3.9， PyQt版本为5.15.4。
另外，因为种种原因，PyQt5的安装可能会出现一些问题，现将本人在安装方法总结如下：
```
pip install PyQt5
pip install PyQt5-tools
pip install sys
pip install os
```
在安装的PyQt库中搜索如下目录
```
"...\plungins\platforms"
```
配置环境变量
```
QT_QPA_PLATFORM_PLUGIN_PATH
PATH: "...\plungins\platforms"
```
到此，PyQt5库就配置完毕。然后本人遇到了PNG图像能够正常加载，JPG图像文件却无法加载的问题。解决办法如下：
```
在安装库文件目录中找到包含qjpeg.dll文件的文件夹imageformats。
```
然后找到Python可执行文件即python.exe所在位置，比如本人位置为
```
"C:\Users\Yuyun1011\AppData\Local\Programs\Python\Python39"
```
最后将上述imageformats文件夹整个copy到python.exe文件所在目录下。
## 4 使用说明
程序的运行交互界面如下：
![image](https://user-images.githubusercontent.com/45918664/184276479-f19b02c2-8835-4e08-bee4-76f8abb75723.png)
- 1 显示打开的RGB图像的绝对路径
- 2 显示打开的IR图像的绝对路径
- 3 显示保存的黑色像素图的绝对路径
- 4 RGB图像的加载位置
- 5 IR图像的加载位置
- 6 黑色像素图的加载位置
- 7 “上一张”按钮，点击后可以同时将当前文件夹下对应的IR和RGB图像的上一幅图像显示出来
- 8 “打开RGB”按钮， 点击后可以选取需要操作的RGB图像，并显示在4的位置
- 9 “下一张”按钮，点击后可以同时将当前文件夹下对应的IR和RGB图像的下一幅图像显示出来
- 10 “打开IR”按钮， 点击后可以选取需要操作的IR图像，并显示在5的位置
- 11 “删除”按钮，点击后可以永久地同时删除当前操作的RGB图像和IR图像，用来清洗无效数据
- 12 “保存”按钮， 点击后可以保存当前被改动的6的位置的黑色像素图
- 快捷键A：按下之后作用等同于 7 “上一张”按钮
- 快捷键S：按下之后作用等同于 12 “保存”按钮
- 快捷键D：按下之后作用等同于 9 “下一张”按钮
- 快捷键C：按下之后可以清空当前三幅图像上的所有笔迹
## 5 文件结构
```
1. face_cover.py：实现本项目功能的源代码文件
2. jpgToPng.py：实现数据集png和jpg格式相互转化的源代码文件
```
## 6 代码使用说明
由于本项目数据集图像的绝对路径结构都是“字符串+数字.jpg”的形式，因此本程序使用数字加减的方式索引不同图像。为了能够使得程序顺利运行，使用者在使用前需要对`face_cover.py`当中的`Winform`类的`open`函数的如下代码进行改动：
```python
# 本例绝对路径为"C:\pyqt\DATA\1\RGB\CQ1\120_RGB_CQ1_1_8535.jpg"
self.imageName = imgName[:37]  # "C:\pyqt\DATA\1\RGB\CQ1\120_RGB_CQ1_1_" 为37个字符
self.imgNum = int(imgName[37:41])  # “8535”为4个字符
```
其中，第一行的[:37]为RBG图像绝对路径“字符串+数字.jpg”字符串字符个数，第二行[37:41]为数字位数。请使用者根据实际情况，改动数值。另外`open_1`函数下的对应位置也应修改，其为打开IR图像的绝对路径。
```python
# 本例绝对路径为"C:\pyqt\DATA\1\IR\CQ1\120_IR_CQ1_1_8535.jpg"
self.imageName_1 = imgName[:35]  # "C:\pyqt\DATA\1\IR\CQ1\120_IR_CQ1_1_" 为35个字符
self.imgNum_1 = int(imgName[35:39])  # “8535”为4个字符
```
## 7 尚未解决的bug
- 1 在作图的时候鼠标单击一次但不拖动时，不能产生笔迹。
- 2 除了“打开RGB”和“打开IR”的所有按钮事件和所有键盘事件都需要另外点击一下程序窗口才会响应。
